# 4-Agent Muti Metroo Example
# Topology: agent1 (ingress) -> agent2 (transit) -> agent3/agent4 (exits)

services:
  # Agent 1: SOCKS5 Ingress + Dashboard
  agent1:
    build:
      context: ../..
      dockerfile: Dockerfile
    container_name: tryout-agent1
    hostname: agent1
    volumes:
      - ./configs/agent1.yaml:/app/config.yaml:ro
    ports:
      - "11080:1080"  # SOCKS5 proxy
      - "18080:8080"  # Dashboard
    networks:
      - mesh
    depends_on:
      - agent2

  # Agent 2: Transit Node (Ubuntu)
  agent2:
    build:
      context: ../..
      dockerfile: examples/docker-tryout/Dockerfile.ubuntu
    container_name: tryout-agent2
    hostname: agent2
    volumes:
      - ./configs/agent2.yaml:/app/config.yaml:ro
    networks:
      - mesh
    depends_on:
      - agent3
      - agent4

  # Agent 3: Exit Node for 0.0.0.0/1 (Ubuntu)
  agent3:
    build:
      context: ../..
      dockerfile: examples/docker-tryout/Dockerfile.ubuntu
    container_name: tryout-agent3
    hostname: agent3
    volumes:
      - ./configs/agent3.yaml:/app/config.yaml:ro
    networks:
      - mesh

  # Agent 4: Exit Node for 128.0.0.0/1 (Ubuntu)
  agent4:
    build:
      context: ../..
      dockerfile: examples/docker-tryout/Dockerfile.ubuntu
    container_name: tryout-agent4
    hostname: agent4
    volumes:
      - ./configs/agent4.yaml:/app/config.yaml:ro
    networks:
      - mesh

networks:
  mesh:
    driver: bridge
